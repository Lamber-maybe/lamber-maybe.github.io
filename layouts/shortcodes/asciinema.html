{{- /* 获取参数 */ -}}
{{- $castFile := .Get "file" | default (.Get 0) -}}
{{- $id := .Get "id" | default (printf "asciinema-%d" (now.Unix)) -}}
{{- $theme := .Get "theme" | default "asciinema" -}}
{{- $speed := .Get "speed" | default 1 -}}
{{- $autoplay := .Get "autoplay" | default false -}}
{{- $loop := .Get "loop" | default false -}}
{{- $startAt := .Get "startAt" | default "" -}}
{{- $poster := .Get "poster" | default "" -}}
{{- $markers := .Get "markers" | default "" -}}
{{- $labeledMarkers := .Get "labeledMarkers" | default "" -}}
{{- $fontSize := .Get "fontSize" | default "15px" -}}
{{- $lineHeight := .Get "lineHeight" | default "1.33333334" -}}
{{- $width := .Get "width" | default "auto" -}}
{{- $height := .Get "height" | default "auto" -}}

{{- /* 构建marker配置 */ -}}
{{- $markerConfig := "" -}}
{{- if or $markers $labeledMarkers -}}
  {{- $markerParts := slice -}}
  
  {{- /* 处理普通marker点 */ -}}
  {{- if $markers -}}
    {{- $markerTimes := split $markers "," -}}
    {{- range $markerTimes -}}
      {{- $markerParts = $markerParts | append (printf "%.1f" (float (trim . " "))) -}}
    {{- end -}}
  {{- end -}}
  
  {{- /* 处理带标签的marker点 */ -}}
  {{- if $labeledMarkers -}}
    {{- $labeledMarkerPairs := split $labeledMarkers "," -}}
    {{- range $labeledMarkerPairs -}}
      {{- $pair := split (trim . " ") ":" -}}
      {{- if ge (len $pair) 2 -}}
        {{- $time := printf "%.1f" (float (index $pair 0)) -}}
        {{- $label := index $pair 1 -}}
        {{- $markerParts = $markerParts | append (printf "[%s,\"%s\"]" $time $label) -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
  
  {{- $markerConfig = printf "[%s]" (delimit $markerParts ",") -}}
{{- end -}}

<div class="asciinema-container" style="width: {{ $width }}; height: {{ $height }};">
  <div id="{{ $id }}" class="asciinema-player" 
       data-cast-file="{{ $castFile }}"
       data-theme="{{ $theme }}"
       data-speed="{{ $speed }}"
       data-autoplay="{{ $autoplay }}"
       data-loop="{{ $loop }}"
       data-font-size="{{ $fontSize }}"
       data-line-height="{{ $lineHeight }}"
       {{- if $startAt -}}data-start-at="{{ $startAt }}"{{- end -}}
       {{- if $poster -}}data-poster="{{ $poster }}"{{- end -}}
       {{- if $markerConfig -}}data-markers="{{ $markerConfig | safeJS }}"{{- end -}}>
  </div>
</div>
